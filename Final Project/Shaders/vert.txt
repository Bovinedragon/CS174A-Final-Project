#version 140

in vec3 vPosition;
in vec3 vNormal;

out vec3 normal;
out vec3 position;
out vec4 color;

uniform vec3 eyePosition;
uniform vec3 lightPosition;

uniform mat4 viewportMatrix;
uniform mat4 modelviewMatrix;

uniform bool vertexLighting;

uniform vec3 ambientColor;
uniform float ambientCoefficient;

uniform vec3 diffuseColor;
uniform float diffuseCoefficient;

uniform vec3 specularColor;
uniform float specularCoefficient;
uniform float specularExponent;

void main() { 
	position = (modelviewMatrix * vec4(vPosition, 1.0f)).xyz; 
    normal = (modelviewMatrix * vec4(vNormal, 0.0f)).xyz;

	if (vertexLighting) {
		vec3 light = normalize(lightPosition - position);
		vec3 eye = normalize(eyePosition  - position);
		vec3 half = normalize(light + eye);
	
		color = vec4(ambientCoefficient * ambientColor + 
			          (diffuseCoefficient * max(dot(normal, light), 0.0f)) * diffuseColor +
				      (specularCoefficient * pow(max(dot(normal, half), 0.0f), specularExponent)) * specularColor  
					  , 1.0f); 
	}
	
    gl_Position = viewportMatrix * modelviewMatrix * vec4(vPosition, 1.0f); 
}